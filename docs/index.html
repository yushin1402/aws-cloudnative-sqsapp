<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Bootstrap Navbar Sidebar - Fixed to Left or Right</title>
    <link rel="stylesheet"
          id="theme_link"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.3.1/materia/bootstrap.min.css"/>
    <link rel="stylesheet" href="./css/navbar-fixed-right.min.css">
    <link rel="stylesheet" href="./css/navbar-fixed-left.min.css">
    <link rel="stylesheet" href="./css/docs.css">
    <script
            src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
            integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8="
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <script src="./css/docs.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <style>
        pre {
            display: inline-block;
            background-color: black;
            border-radius: 3px;
            padding: 0.1em 0.2em;
            color: royalblue;
        }
        img {
            width: "10px";
            height: "10px";
        }
        p{
            font-size: large;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-md navbar-dark bg-primary fixed-top p-1 ">
        <a class="navbar-brand" href>CloudNativeAPP(BFFç·¨)</a>
        <div class="collapse navbar-collapse " style="line-height: 0.5em"> 
            <ul class="navbar-nav" >
                <li class="nav-item">
                    <a class="nav-link" href="#1">1.AWSç’°å¢ƒæº–å‚™</a>
                    <a class="nav-link" href="#2">2.ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</a>
                    <ul>
                        <a class="nav-link" href="#2-1">2-1.backendãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</a>
                        <a class="nav-link" href="#2-2">2-2.bffãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ</a>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h1 id="1">1.Producerã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…</h1>
        <p>
            <ul>
                <h1 id="1-1">1-1.Configã‚¯ãƒ©ã‚¹å®Ÿè£…</h1>
                <p>
                    ä»¥ä¸‹3ã¤ã®Configã‚¯ãƒ©ã‚¹ã‚’ä½œæˆ
                    <table class="table">
                        <tr>
                            <th>ã‚¯ãƒ©ã‚¹å</th>
                            <th>å½¹å‰²</th>
                            <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                        </tr>
                        <tr>
                            <td>MvcConfig</td>
                            <td>SpringMVCã®è¨­å®šã‚¯ãƒ©ã‚¹</td>
                            <td>
                                RestControllerã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã€Controllerã‚¯ãƒ©ã‚¹ãŒé…ç½®ã•ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚³
                                ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚­ãƒ£ãƒ³å¯¾è±¡ã«è¿½åŠ ã™ã‚‹ã€‚(ã‚³ãƒ¼ãƒ‰ã¯å‰²æ„›)
                            </td>                            
                        </tr>
                        <tr>
                            <td>DomainConfig</td>
                            <td>ã‚µãƒ¼ãƒ“ã‚¹ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£ãƒ¬ã‚¤ãƒ¤ã®è¨­å®šã‚¯ãƒ©ã‚¹</td>
                            <td>
                                Repositoryã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã—ã¦SQSã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã€
                                ã“ã®ã‚¯ãƒ©ã‚¹ã§RepositoryãŒé…ç½®ã•ã‚Œã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¹ã‚­ãƒ£ãƒ³å¯¾è±¡ã¨ã™ã‚‹ã€‚
                                ï¼ˆã‚³ãƒ¼ãƒ‰ã¯å‰²æ„›)
                            </td>
                        </tr>
                        <tr>
                            <td>SqsCongif</td>
                            <td>SQSã®æ¥ç¶šã‚’è¡Œã†è¨­å®šã‚¯ãƒ©ã‚¹</td>
                            <td>
                                SQSã¸ã®æ¥ç¶šæƒ…å ±ã‚’å®šç¾©ã™ã‚‹ã€‚AmazonSDKãŒæä¾›ã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª(AmazonSQSASync)ã‚’åˆ©ç”¨ã™ã‚‹ã€‚
                                QueueMessageingTemplateã‚¯ãƒ©ã‚¹ã«AmazonSQSASyncã‚’è¨­å®šã—ã€Beanå®šç¾©ã™ã‚‹ã€‚
                                ã¾ãŸã€AmazonSQSASyncã®EndopointConfigurationã«ã¯åˆ©ç”¨ã™ã‚‹SQSã‚­ãƒ¥ãƒ¼ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæƒ…å ±ã‚’è¨­å®šã™ã‚‹ã€‚
                                ãªãŠã€ã“ã‚Œã‚‰ã®æƒ…å ±ã¯å¤‰æ›´ã‚’ç”¨æ„ã™ã‚‹ãŸã‚ã«<code>@Value</code>ã‚’ç”¨ã„ã¦ã€appplication.ymlã‹ã‚‰å–å¾—ã™ã‚‹è¨­å®šã¨ã™ã‚‹ã€‚
                                <br>
                                <pre><code>
        package org.debugroom.mynavi.sample.aws.sqs.config;

        import com.amazonaws.client.builder.AwsClientBuilder;
        import com.amazonaws.services.sqs.AmazonSQSAsync;

        import org.springframework.beans.factory.annotation.Autowired;
        import org.springframework.beans.factory.annotation.Value;
        import org.springframework.cloud.aws.messaging.core.QueueMessagingTemplate;
        import org.springframework.context.annotation.Bean;
        import org.springframework.context.annotation.Configuration;

        @Configuration
        public class SqsConfig {
        
            @Value("${queue.endpoint}")
            private String queueEndpoint;
            @Value("${cloud.aws.region.static}")
            private String region;
        
            @Autowired
            AmazonSQSAsync amazonSQSAsync;
        
            @Bean
            public AwsClientBuilder.EndpointConfiguration endpointConfiguration(){
                return new AwsClientBuilder.EndpointConfiguration(queueEndpoint, region);
            }
        
            @Bean
            public QueueMessagingTemplate queueMessagingTemplate(){
                return new QueueMessagingTemplate(amazonSQSAsync);
            }
        
        }
                                </code></pre>
                            </td>
                        </tr>
                    </table>
                </p>
                <h1 id="1-2">1-2.ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚¯ãƒ©ã‚¹å®Ÿè£…</h1>
                <p>
                    ç”»é¢æ“ä½œã‚’å—ã‘ä»˜ã‘ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã€‚ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚¯ãƒ©ã‚¹ã§ã¯ã€SQSãƒ˜ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãŒå®Ÿè£…ã•ã‚ŒãŸSampleRepositoy
                    ã¨å‡¦ç†çµæœã‚’JSONã§è¿”å´ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚ãªãŠã€sampleRepository.saveã¯SQSã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã™ã‚‹å‡¦ç†ã§ã‚ã‚‹ã€‚
                    <br>
                    <pre><code>
        package org.debugroom.mynavi.sample.aws.sqs.app.web;

        import org.debugroom.mynavi.sample.aws.sqs.domain.model.Sample;
        import org.debugroom.mynavi.sample.aws.sqs.domain.repository.SampleRepository;
        import org.springframework.beans.factory.annotation.Autowired;
        import org.springframework.web.bind.annotation.GetMapping;
        import org.springframework.web.bind.annotation.RequestMapping;
        import org.springframework.web.bind.annotation.RestController;

        @RestController
        @RequestMapping("api/v1")
        public class SampleRestController {
        
            @Autowired
            SampleRepository sampleRepository;
        
            @GetMapping("/batch")
            public String batch(String message){
                sampleRepository.save(
                        Sample.builder()
                                .message(message)
                                .build()
                );
                return "Queue accepted.";
            }
                    </code></pre>
                </p>
                <h1 id="1-3">1-3.Repositoryã‚¯ãƒ©ã‚¹å®Ÿè£…</h1>
                <p>
                    SQSã¸ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã™ã‚‹Repositoryã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã€‚QueueMessagingTemplate ã®convertAndSendãƒ¡ã‚½ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ã¦ã€
                    ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‹ã‚‰æ¸¡ã•ã‚ŒãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã™ã‚‹ã€‚convertAndSendã®ç¬¬ï¼‘å¼•æ•°ã«ã¯SQSã®åç§°ã‚’ã€ç¬¬2å¼•æ•°ã«ã¯modelã‚¯ãƒ©ã‚¹ã®
                    ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£(ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã‚¯ã‚¨ãƒªæƒ…å ±ãŒæ ¼ç´ã•ã‚ŒãŸã‚¯ãƒ©ã‚¹)ã‚’æŒ‡å®šã™ã‚‹ã€‚
                    <br>
                    <pre><code>
        package org.debugroom.mynavi.sample.aws.sqs.domain.repository;

        import org.springframework.beans.factory.annotation.Autowired;
        import org.springframework.cloud.aws.messaging.core.QueueMessagingTemplate;
        import org.springframework.stereotype.Component;

        import org.debugroom.mynavi.sample.aws.sqs.domain.model.Sample;

        @Component
        public class SampleRepositoryImpl implements SampleRepository{
        
            @Autowired
            QueueMessagingTemplate queueMessagingTemplate;
        
            @Override
            public void save(Sample sample) {
                queueMessagingTemplate.convertAndSend("MA-saitoumsv-sqs-standard", sample.getMessage());
            }
        
        }
                    </code></pre>
                </p>
            </ul>     
            <h1 id="2">2.ãƒãƒƒãƒå‡¦ç†ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…</h1>
            <p>
                SQSã§å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…ƒã«ãƒãƒƒãƒå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã€‚
                ãƒãƒƒãƒã‚¢ãƒ—ãƒªã¯SpringBoot+SpringBatchã§æ§‹ç¯‰ã™ã‚‹ã€‚åŸºæœ¬çš„ãªæ§‹ç¯‰æ–¹æ³•ã¯ä»¥ä¸‹ã«ã¾ã¨ã‚ã¦ã„ã‚‹ãŸã‚ã€å‚ç…§ã€‚
                <br>    
                <a href src="https://yushin1402.github.io/SpringBatchSample/index.html">SpringBatchã‚µãƒ³ãƒ—ãƒ«</a>
                <ul>
                    <h1 id="2-1">2-1.Configã‚¯ãƒ©ã‚¹ã®å®Ÿè£…</h1>
                    <p>
                        ãƒãƒƒãƒå‡¦ç†ã®å®Ÿè¡Œå®šç¾©ã‚’è¨˜è¿°ã—ãŸConfigã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã€‚ã‚¿ã‚¹ã‚¯ã€ã‚¸ãƒ§ãƒ–ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã€ã‚¸ãƒ§ãƒ–ã«çµ„ã¿è¾¼ã‚“ã§ã„ãã‚¤ãƒ¡ãƒ¼ã‚¸ã§å®Ÿè£…ã™ã‚‹ã€‚
                        ä»¥ä¸‹ã«ã€å¿œç”¨çš„ãªãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã„ã¦è¨˜è¿°ã™ã‚‹ã€‚
                        <p>
                        <br>
                        <pre><code>
    @Bean
    @StepScope
    @Value("#{jobExecutionContext['paramBySampleTasklet']}")
    public FlatFileItemReader<Sample> sampleFlatFileItemReader(String paramBySampleTasklet){

        FlatFileItemReader<Sample> flatFileItemReader = new FlatFileItemReader<>();

        flatFileItemReader.setResource(new DefaultResourceLoader().getResource(paramBySampleTasklet));

        DefaultLineMapper<Sample> defaultLineMapper = new DefaultLineMapper<>();
        DelimitedLineTokenizer delimitedLineTokenizer = new DelimitedLineTokenizer();
        delimitedLineTokenizer.setNames("stepParam");
        defaultLineMapper.setLineTokenizer(delimitedLineTokenizer);

        BeanWrapperFieldSetMapper<Sample> beanWrapperFieldSetMapper = new BeanWrapperFieldSetMapper<>();
        beanWrapperFieldSetMapper.setTargetType(Sample.class);
        defaultLineMapper.setFieldSetMapper(beanWrapperFieldSetMapper);

        flatFileItemReader.setLineMapper(defaultLineMapper);

        return flatFileItemReader;
                        </code></pre>
                        <br>
                        SQSã§å—ä¿¡ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€Readerã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã€‚
                        </p>
                        <p>
                            <br>
                            <pre><code>
        @Bean
        public TaskExecutor taskExecutor(){
            SimpleAsyncTaskExecutor simpleAsyncTaskExecutor = new SimpleAsyncTaskExecutor();
            simpleAsyncTaskExecutor.setConcurrencyLimit(10);
            return simpleAsyncTaskExecutor;
        }
                            </code></pre>
                            <br>
                            ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã«ã‚ˆã‚‹ãƒãƒƒãƒå‡¦ç†ã®ä¸¦åˆ—å®Ÿè¡Œã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã€‚setConcurrencyLimit(10)ã«ã‚ˆã‚ŠåŒæ™‚å®Ÿè¡Œæ•°ã¯10ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚
                            ãªãŠã€SpringBatchã¯ã‚¹ãƒ†ãƒƒãƒ—ã‚’ãã®ã¾ã¾ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå‡ºæ¥ãªã„ã€‚æœ¬ã‚¢ãƒ—ãƒªã§ã¯ã€Stepã‚’<code>partitioner</code>ã«ã‚ˆã£ã¦
                            ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ã™ã‚‹ã“ã¨ã§ã€ä¸¦åˆ—å®Ÿè¡Œã‚’å¯èƒ½ã«ã—ã¦ã„ã‚‹ã€‚ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ã‚’ã™ã‚‹ã¨ã€ã‚¹ãƒ†ãƒƒãƒ—ã®å®Ÿè¡Œå˜ä½ãŒè‡ªå‹•çš„ã«åˆ†å‰²ã•ã‚Œã€å®Ÿéš›ã«å‡¦ç†ã‚’è¡Œã†
                            workerã‚¹ãƒ¬ãƒƒãƒ‰ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ã€‚å…¨ã¦ã®workerã‚¹ãƒ¬ãƒƒãƒ‰ãŒå‡¦ç†ã‚’å®Œäº†ã—ãŸã‚‰ã€ãƒã‚¹ã‚¿ãƒ¼ã‚¹ãƒ¬ãƒƒãƒ‰ã«é€šçŸ¥ã•ã‚Œã€æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã«é·ç§»ã™ã‚‹ã€‚
                        </p>
                    </p>
                    <h1 id="2-2">2-2.Taskletã‚¯ãƒ©ã‚¹ã®å®Ÿè£…</h1>
                    <p>
                        <ol>
                            <li>Step1ã®Taskletã®å®Ÿè£…</li>
                            <p>
                            ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦Readerã‹ã‚‰é€£æºã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹ãƒãƒƒãƒå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚
                            åŒä¸€ã‚¹ãƒ†ãƒƒãƒ—å†…ã‹ã‚‰é€£æºã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯ChunkContextã‹ã‚‰å–å¾—ã§ãã‚‹ã€‚
                            <br>
                            <code>String param = stepExecution.getJobParameters().getString("param");</code>
                            <br>
                            ä¸Šè¨˜ã§å–å¾—ã—ãŸ<code>param</code>ã¯ã€Slf4Jã‚’åˆ©ç”¨ã—ã¦ãƒ­ã‚°å‡ºåŠ›ã™ã‚‹ã€‚ã¾ãŸã€
                            Step1ã®å‡ºåŠ›ã‚’Step2ã«é€£æºã«ã¯ã€ExecutionContextã‚’åˆ©ç”¨ã™ã‚‹ã€‚
                            <br>
                            <code>ExecutionContext jobExecutionContext = stepExecution.getJobExecution().getExecutionContext()</code>
                            <br>
                            ä¸Šè¨˜ã§å–å¾—ã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¯<code>ExecutionContext#put</code>ã§ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã—ã¦ãŠãã€‚
                            <br>
                            <code>jobExecutionContext.put("paramBySampleTasklet", "/test.txt");</code>
                            <br>
                            æœ€å¾Œã«ã€<code>RepeatStatus</code>ã‚’åˆ©ç”¨ã—ã¦çµ‚äº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨­å®šã—ã¦ãƒªã‚¿ãƒ¼ãƒ³ã™ã‚‹ã€‚
                            <br>
                            <code>return RepeatStatus.FINISHED</code>
                            <br>
                            <p>
                                <pre><code>
        package org.debugroom.mynavi.sample.aws.sqs.app.batch.step;
        import org.springframework.batch.core.StepContribution;
        import org.springframework.batch.core.StepExecution;
        import org.springframework.batch.core.scope.context.ChunkContext;
        import org.springframework.batch.core.step.tasklet.Tasklet;
        import org.springframework.batch.item.ExecutionContext;
        import org.springframework.batch.repeat.RepeatStatus;
        
        import lombok.extern.slf4j.Slf4j;
        
        @Slf4j
        public class SampleTasklet implements Tasklet {
        
            @Override
            public RepeatStatus execute(StepContribution stepContribution,
                                        ChunkContext chunkContext) throws Exception {
        
        
                StepExecution stepExecution = chunkContext.getStepContext().getStepExecution();
        
                String param = stepExecution.getJobParameters().getString("param");
        
                log.info(this.getClass().getName() + "#execute() starteds. input param : " + param);
        
                ExecutionContext jobExecutionContext = stepExecution.getJobExecution().getExecutionContext();
        
                jobExecutionContext.put("paramBySampleTasklet", "/test.txt");
        
                return RepeatStatus.FINISHED;
        
            }
        
        }

                                </code></pre>
                            </p>
                            <li>Step2ã®Readerã®å®Ÿè£…</li>
                            <p>
                            ç¶šã„ã¦ã€Step1ãŒ<code>jobExecutionContext</code>ã«è¨­å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒ—ãƒƒãƒˆã«å‹•ä½œã™ã‚‹
                            Step2ã‚’å®Ÿè£…ã™ã‚‹ã€‚ã¾ãšã¯Step1ã‹ã‚‰é€£æºã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€Reaaderã‚’å®Ÿè£…ã™ã‚‹ã€‚
                            Readerã¯æ—¢ã«BatchAppConfigã‚¯ãƒ©ã‚¹ä¸Šã§å®Ÿè£…æ¸ˆã¿ã¨ãªã‚‹ã€‚
                            Step1ã®taskletã§è¨­å®šã—ãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã€ã‚¤ãƒ³ãƒ—ãƒƒãƒˆãŒè¨˜è¿°ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’èª­ã¿è¾¼ã‚€ã€‚
                            <br>
                            <code>flatFileItemReader.setResource(new DefaultResourceLoader().getResource(paramBySampleTasklet));</code>
                            <br>
                            è«¸ã€…ã®ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿è¨­å®š(åŒºåˆ‡ã‚Šæ–‡å­—è¨­å®šãªã©)ã‚’è¡Œã£ãŸã®ã¡ã€èª­ã¿è¾¼ã‚“ã å€¤ã‚’ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã€‚
                            <br>
                            <code>beanWrapperFieldSetMapper.setTargetType(Sample.class);</code>
                            ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹(Sampleã‚¯ãƒ©ã‚¹)å´ã«ã¯å¤‰æ•°<code>stepParam</code>ãŒå®šç¾©ã•ã‚Œã¦ãŠã‚Šã€ä»¥ä¸‹ã®è¨˜è¿°ã§ã“ã‚Œã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦ã„ã‚‹ã€‚
                            <br>
                            <code>delimitedLineTokenizer.setNames("stepParam");</code>
                            <br>
                            <pre><code>
        @Bean
        @StepScope
        @Value("#{jobExecutionContext['paramBySampleTasklet']}")
        public FlatFileItemReader<Sample> sampleFlatFileItemReader(String paramBySampleTasklet){
    
            FlatFileItemReader<Sample> flatFileItemReader = new FlatFileItemReader<>();
    
            flatFileItemReader.setResource(new DefaultResourceLoader().getResource(paramBySampleTasklet));
    
            DefaultLineMapper<Sample> defaultLineMapper = new DefaultLineMapper<>();
            DelimitedLineTokenizer delimitedLineTokenizer = new DelimitedLineTokenizer();
            delimitedLineTokenizer.setNames("stepParam");
            defaultLineMapper.setLineTokenizer(delimitedLineTokenizer);
    
            BeanWrapperFieldSetMapper<Sample> beanWrapperFieldSetMapper = new BeanWrapperFieldSetMapper<>();
            beanWrapperFieldSetMapper.setTargetType(Sample.class);
            defaultLineMapper.setFieldSetMapper(beanWrapperFieldSetMapper);
    
            flatFileItemReader.setLineMapper(defaultLineMapper);
    
            return flatFileItemReader;
        }
                            </code></pre>
                        </p>
                        <li>Partitionerã‚¯ãƒ©ã‚¹ã®å®Ÿè£…</li>
                        <p>
                            ã“ã®ã‚ã¨ã€Readerã§èª­ã¿è¾¼ã‚“ã å€¤ã‚’åŠ å·¥ã™ã‚‹Proessorã‚¯ãƒ©ã‚¹ã‚„DBãªã©ã«æ›¸ãè¾¼ã‚€Writeã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ãŒãã®å‰ã«ã€ã“ã‚Œã‚‰ã®ã‚¯ãƒ©ã‚¹ã¯ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ã™ã‚‹ã“ã¨ã§
                            ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ãŸã‚ã€Partitionaerã‚¯ãƒ©ã‚¹ã®å®Ÿè£…ãŒå¿…è¦ã¨ãªã‚‹ã€‚ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³åŒ–ã®å®£è¨€è‡ªä½“ã¯BatchAppConfigã§å®Ÿè£…æ¸ˆã¿ã ãŒã€Processorã‚¯ãƒ©ã‚¹ä¸Šã§ã¯ã€
                            ä¸¦åˆ—å®Ÿè¡Œã•ã›ã‚‹ã‚¹ãƒ¬ãƒƒãƒ‰æ•°ã«å¿œã˜ãŸãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³IDã®ä½œæˆã‚„ã€ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³IDã¨IDã®å€¤ã‚’ExecutionContext#putString
                            ã«è¨­å®šã—ã€ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’è­˜åˆ¥ã™ã‚‹æ–‡å­—åˆ—ã¨ExecutionContextã‚’ãƒšã‚¢ã§Mapã«è¨­å®šã—ã¦è¿”å´ã™ã‚‹å‡¦ç†ã‚’å®Ÿè£…ã—ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚
                            ã¾ãšã¯Mapã‚’ä»¥ä¸‹ã®é€šã‚Šä½œæˆã™ã‚‹ã€‚å‹ã«String(ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ID)ã¨ExectutionContextã‚’è¨­å®šã—ãŸMapã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚
                            <br>
                            <code>Map<String, ExecutionContext> executionContextMap = new HashMap<>();</code>
                            <br>
                            æ¬¡ã«ã€whileåˆ†ã§èª­ã¿è¾¼ã‚€å…¥åŠ›å€¤ã‚’ãƒãƒƒãƒ•ã‚¡ã«è¨­å®šã™ã‚‹ã€‚
                            <br>
                            <code>
                                InputStream inputStream = getClass().getResourceAsStream(param);<br>
                                Reader reader = new InputStreamReader(inputStream);<br>
                                BufferedReader bufferedReader = new BufferedReader(reader);)<br>
                            </code>
                            <br>
                            èª­ã¿è¾¼ã‚“ã å…¥åŠ›å€¤ãŒç©ºã«ãªã‚‹ã¾ã§whileåˆ†ã‚’å›ã—ã€å„å…¥åŠ›å€¤ã«ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³IDã‚’ä»˜ä¸ã™ã‚‹ã€‚
                            ã“ã‚Œã«ã‚ˆã‚Šã€å„workerã‚¹ãƒ¬ãƒƒãƒ‰ãŒå‡¦ç†ã™ã‚‹ãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³IDãŒè¨­å®šã•ã‚Œã€ä¸¦åˆ—å‡¦ç†ãŒå¯èƒ½ã¨ãªã‚‹ã€‚
                            <br>
                            <code>
                                String readLine;<br>
                                int index = 0;<br>
                                while ((readLine = bufferedReader.readLine()) != null){<br>
                                    ExecutionContext executionContext = new ExecutionContext();<br>
                                    executionContext.putString("partitionId", readLine);<br>
                                    executionContextMap.put("partition" + index, executionContext);<br>
                                    index++;<br>
                                } <br>
                                <br>                 
                            </code>
                        </p>
                        <li>Processorã‚¯ãƒ©ã‚¹ã®å®Ÿè£…</li>
                        <p>
                            Processorã‚¯ãƒ©ã‚¹ã§ã¯ã€stepExecutionã‹ã‚‰ReaderãŒè¨­å®šã—ãŸå…¥åŠ›å€¤ã‚’èª­ã¿è¾¼ã¿ã€ãƒ­ã‚°å‡ºåŠ›ã™ã‚‹å‡¦ç†ã‚’è¨˜è¿°ã™ã‚‹ã€‚
                            ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦ã€ãƒ¢ãƒ‡ãƒ«ã‚¯ãƒ©ã‚¹ã®getStepParamã®å€¤ã¨PartitionIDãŒä¸€è‡´ã—å ´åˆã«ãƒ­ã‚°å‡ºåŠ›ã‚’è¡Œã†å‡¦ç†ã‚’å®Ÿè£…ã—ãŸã€‚
                            <br>
                            <pre><code>
    @Value("#{stepExecution}")
    private StepExecution stepExecution;

    @Override
    public Sample process(Sample sample) throws Exception {
        ExecutionContext stepExecutionContext = stepExecution.getExecutionContext();
        ExecutionContext jobExecutionContext =
                stepExecution.getJobExecution().getExecutionContext();

        if(Objects.equals(sample.getStepParam(), stepExecutionContext.get("partitionId"))){
            log.info(this.getClass().getName()
                    + " started. sample.stepParam:" + sample.getStepParam()
                    + " stepExecution.partitionId:" + stepExecutionContext.getString("partitionId"));
        }

        return sample;                                
                            </code></pre>
                        </p>
                        <li>Writerã‚¯ãƒ©ã‚¹ã®å®Ÿè£…</li>
                        <p>
                            Processorã‚¯ãƒ©ã‚¹ã¨ã»ã¼åŒã˜ã‚ˆã†ãªå†…å®¹ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã€‚
                            <pre><code>
        samples.stream()
                .filter(sample -> Objects.equals(((Sample) sample).getStepParam(), stepExecutionContext.get("partitionId")))
                .forEach(sample -> {
                    log.info(this.getClass().getName() + " sample.stepParam:" + ((Sample) sample).getStepParam());
                });

        stepExecutionContext.put("status", "complete!");
                            </code></pre>

                        </p>
                    </ol>
                    </p>
                </ul>
            </p>
            <h1 id="3">3.Consumerã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…</h1>
            <p>
                SpringBatchã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‘¼ã³å‡ºã™Consumerã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã€‚
                ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€SQSã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ¼ãƒªãƒ³ã‚°ã—ã¦å–å¾—ã—ã€å–å¾—å€¤ã‚’å…ƒã«SpringBatchã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
                <ol>
                    <li>Configã‚¯ãƒ©ã‚¹ã®å®Ÿè£…</li>
                    <p>
                        SQSã«æ¥ç¶šã™ã‚‹ãŸã‚ã®è¨­å®šã‚’å®šç¾©ã—ãŸSqsConfigã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã€‚å®Ÿè£…æ–¹æ³•ã¯Producerã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ä½œæˆã—ãŸã‚‚ã®ã¨åŒæ§˜ã€‚
                    </p>
                    <li>listenerã‚¯ãƒ©ã‚¹ã®å®Ÿè£…</li>
                    <p>
                        ç¶šã„ã¦ã€SQSã¸ã®ãƒãƒ¼ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã™ã‚‹listerã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã€‚
                        ã‚¯ãƒ©ã‚¹ã«<code>@EnableSqs</code>ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ã§ã€SQSã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒå¯èƒ½ã¨ãªã‚‹ã€‚
                        ã¾ãŸã€SQSã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã—ãŸå¾Œã«SpringBatchã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹å‡¦ç†ã«ä»¥ä¸‹ã‚’
                        ä»˜ä¸ã™ã‚‹ã“ã¨ã§SQSãƒãƒ¼ãƒªãƒ³ã‚°ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã‚‹ã€‚<br>
                        <code>@SqsListener(value = "MA-saitoumsv-sqs-standard", deletionPolicy = SqsMessageDeletionPolicy.ON_SUCCESS)</code>
                    </p>
                </ol>
                <p>
                    (2022/1/16 ã‚³ãƒ¡ãƒ³ãƒˆ)<br>
                    consumerã‚¢ãƒ—ãƒªã®SQSãƒªã‚¹ãƒŠãƒ¼ã‹ã‚‰spring-batchã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§å®Ÿè£…ã—ãŸJobã‚’å®Ÿè¡Œã§ãã‚‹ä»•çµ„ã¿ãŒç†è§£å‡ºæ¥ã¦ã„ãªã„ã€‚
                    consumerã‚¢ãƒ—ãƒªã®MessageListnerã‚¯ãƒ©ã‚¹å´ã§ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã—ãŸJobã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’JobLauncherã«æ¸¡ã—ã¦ã€SpringBatchã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã“ã¨ã¯ç†è§£ã§ãã‚‹ãŒã€
                    ãªãœã€spring-batchã‚¢ãƒ—ãƒªå´ã®åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§å®šç¾©ã—ãŸJobã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒBeanç™»éŒ²å‡ºæ¥ã¦ã„ã‚‹ã‹ãŒåˆ†ã‹ã‚‰ãªã„ã€‚
                    SpringBatchã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ä¸Šã‚‚ã€åˆ¥ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®Jobã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è‡ªå‹•ã§Beanç™»éŒ²ã™ã‚‹ã‚ˆã†ãªè¨˜è¼‰ã¯ãªã„ã€‚
                    (JobLauncherãŒ@EnableBatchProcessingã«ã‚ˆã‚Šè‡ªå‹•ã§Beanç™»éŒ²ã•ã‚Œã‚‹è¨˜è¼‰ã¯ã‚ã‚‹ã®ã§ã“ã®ã‚ãŸã‚ŠãŒé–¢ä¿‚ã—ã¦ã„ã‚‹ï¼Ÿ)
                </p>
            </p>
            <h1 id="4">4.ECSã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤</h1>
            <ul>
                <h1 id="4-1">4-1.Priducerã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ—ãƒ­ã‚¤</h1>
                <ol>
                    <li>Producerã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®Dockerfileã‚’ä½œæˆã™ã‚‹ã€‚</li>
                    <li>ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã€‚</li>
                    <p>
                        <code>docker build sqs-producer/ -t yushin1402/aws-cloudnative-sqsapp-producer:latest --no-cache</code>
                        <br>
                        ï¼ˆâ€»)ä½•åº¦ã‹ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãŸã¾ã‚‹ã€‚ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å¤‰æ›´ãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã«åæ˜ ã•ã‚Œãªã„å ´åˆãŒã‚ã‚‹ã€‚
                             ã“ã®å ´åˆã¯ä¸Šè¨˜ã®é€šã‚Šã€<code>--no-chache</code>ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’åˆ©ç”¨ã—ãªã„ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
                             ã‚¢ãƒ—ãƒªã«å¤‰æ›´ã‚’åŠ ãˆãŸã«ã‚‚é–¢ã‚ã‚‰ãšã€å„ãƒ“ãƒ«ãƒ‰ã‚¹ãƒ†ãƒƒãƒ—ã§ã€ŒLayer already existsã€ã¨å‡ºåŠ›ã•ã‚ŒãŸå ´åˆã¯ã‚¤ãƒ¡ãƒ¼ã‚¸ã«å¤‰æ›´å‡ºæ¥ã¦ã„ãªã„å¯èƒ½æ€§ãŒé«˜ã„ã€‚
                             å®Ÿéš›ã«å¤‰æ›´ãŒåæ˜ ã•ã‚ŒãŸã‹ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã§ã‚³ãƒ³ãƒ†ãƒŠã«ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã€‚
                             <br>
                             <code>docker run -d -p 1080:8080 yushin1402/aws-cloudnative-sqsapp-producer:latest java -jar -Dspring.profiles.active=dev /usr/local/aws-cloudnative-sqsapp/sqs-producer/target/sqs-producer-0.0.1-SNAPSHOT.jar</code>
                             <br>
                             <code>docker exec -it fb79902a8ae4 /bin/bash</code>
                    </p>
                    <li>DockerHubã«ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã€‚</li>
                    <li>ECSã®ã‚¿ã‚¹ã‚¯å®šç¾©ã«ä½œæˆã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®šã™ã‚‹ã€‚</li>
                    <li>ECSã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚ã“ã®éš›ã€SQSFullAccessãƒãƒªã‚·ãƒ¼ã‚’ã‚¢ã‚¿ãƒƒãƒã—ãŸIAMãƒ­ãƒ¼ãƒ«ã‚’ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè¡Œãƒ­ãƒ¼ãƒ«ã«å‰²ã‚Šå½“ã¦ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚</li>
                </ol>
                <h1 id="4-2">4-2.Consumerã‚¢ãƒ—ãƒªã¨SpringBatchã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ—ãƒ­ã‚¤</h1>
                Consumerã‚¢ãƒ—ãƒªã¨SpringBatchã‚¢ãƒ—ãƒªã¯åŒã˜ã‚³ãƒ³ãƒ†ãƒŠå†…ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã€‚(Consumerã‚¢ãƒ—ãƒªã®ãƒªã‚¹ãƒŠãƒ¼ãŒSpringBatchã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚‹æ§‹æˆã®ãŸã‚)
                ã“ã®ãŸã‚ã€SpringBatchã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ç”Ÿæˆã—ãŸJarãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’Consumerã‚¢ãƒ—ãƒªã®å‚ç…§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«çµ„ã¿è¾¼ã‚€å½¢ã§ãƒ“ãƒ«ãƒ‰å‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚
                <br>
                <ol>
                    <li>SpringBatchã‚¢ãƒ—ãƒªã®Jarç”Ÿæˆ</li>
                    <p>
                        STSã®Mavenãƒ“ãƒ«ãƒ‰ã§å®Ÿè¡Œã™ã‚‹ã€‚ä½œæˆã—ãŸJarãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€Consumerã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ/lib/ã«ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã€‚(ã“ã®ãƒ‘ã‚¹ã‚’Consumerã‚¢ãƒ—ãƒªã®pom.xmlã§æŒ‡å®šã™ã‚‹ã€‚)
                    </p>
                    <li>Consumerã‚¢ãƒ—ãƒªã®pom.xmlä¿®æ­£</li>
                    <p>
                        Consumerã‚¢ãƒ—ãƒªã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’Mavenã‚¯ãƒªãƒ¼ãƒ³ã—ãŸéš›ã«ä½œæˆã—ãŸSpringBatchã‚¢ãƒ—ãƒªã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸä¸Šã§ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã™ã‚‹ã‚ˆã†ã€è¨­å®šã‚’è¨˜è¿°ã™ã‚‹ã€‚
                        <br>
                        [Dependancy]
                        <br>
                        <pre><code>
        &lt;dependency&gt;
            &lt;groupId&gt;org.debugroom&lt;/groupId&gt;
            &lt;artifactId&gt;spring-batch&lt;/artifactId&gt;
            &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
        &lt;/dependency&gt;                            
                        </code></pre>
                        <br><br>
                        [Build]
                        <br>
                        <pre><code>
		&lt;plugin&gt;
			&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
			&lt;artifactId&gt;maven-install-plugin&lt;/artifactId&gt;
			&lt;executions&gt;
				&lt;execution&gt;
					&lt;id&gt;install-external&lt;/id&gt;
					&lt;phase&gt;clean&lt;/phase&gt;
					&lt;configuration&gt;
						&lt;file&gt;${basedir}/lib/spring-batch-0.0.1-SNAPSHOT.jar&lt;/file&gt;
						&lt;repositoryLayout&gt;default&lt;/repositoryLayout&gt;
						&lt;groupId&gt;org.debugroom&lt;/groupId&gt;
						&lt;artifactId&gt;spring-batch&lt;/artifactId&gt;
						&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
						&lt;packaging&gt;jar&lt;/packaging&gt;
						&lt;generatePom&gt;true&lt;/generatePom&gt;
					&lt;/configuration&gt;
					&lt;goals&gt;
						&lt;goal&gt;install-file&lt;/goal&gt;
					&lt;/goals&gt;
				&lt;/execution&gt;
			&lt;/executions&gt;
		&lt;/plugin&gt;
                        </code></pre>
                    </p>
                    <li>STSã®å®Ÿè¡Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€Mavenã‚¯ãƒªãƒ¼ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã€‚</li>
                    <li>STSã®å®Ÿè¡Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã€ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†ã€‚SUCCESSã™ã‚Œã°OKã€‚</li>
                    <li>ä¸Šè¨˜ã¨åŒæ§˜ã®å‡¦ç†ã‚’è¡Œã†Dockerfileã‚’ä½œæˆã™ã‚‹ã€‚</li>
                    <p>
                    </p>
                </ol>
                <br>
                (2022/1/24 ã‚³ãƒ¡ãƒ³ãƒˆ)
                <p>
                    ä¸Šè¨˜ã®é€šã‚Šã€spring-batchã®jarã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦sqs-consumerã«å–ã‚Šè¾¼ã‚‚ã†ã¨ã—ãŸãŒã€
                    spring-batchã®jarã¯spring-bootã¨ã—ã¦èµ·å‹•ã•ã›ã‚‹ã“ã¨ãŒå‰æã®å®Ÿè¡Œå¯èƒ½jarã§ã‚ã‚Šã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ä¸Šæ‰‹ãèªè­˜ã•ã‚Œãªã‹ã£ãŸã€‚
                    ä»–ã®jarãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨æ¯”è¼ƒã—ã¦ã‚‚ä¸­èº«ã®æ§‹æˆãŒæ˜ã‚‰ã‹ã«é•ã†ã€‚
                </p>
                <h1 id="è³ªå•">è³ªå•.sqs-consumerã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰æ–¹æ³•ã«ã¤ã„ã¦</h1>
                <p>
                    sqs-consumerã‚¢ãƒ—ãƒªã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã€ECSã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸã¨ã“ã‚ã€æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã£ã¦ã¯ã¾ã£ã¦ã„ã¾ã™ã€‚
                    <br>
                    <pre><code>
    ***************************
    APPLICATION FAILED TO START
    ***************************
    
    Description:
    
    Field jobLauncher in org.debugroom.mynavi.sample.aws.sqs.app.listener.MessageListener required a bean of type 'org.springframework.batch.core.launch.JobLauncher' that could not be found.
    
    The injection point has the following annotations:
            - @org.springframework.beans.factory.annotation.Autowired(required=true)
    Action:    
    Consider defining a bean of type 'org.springframework.batch.core.launch.JobLauncher' in your configuration.
                    </code></pre>
                    <br>
                    <p>
                    æœ¬ä»¶ã«ã¤ã„ã¦ã€sqs-consumerã‚¢ãƒ—ãƒªã‚’ã©ã®ã‚ˆã†ã«ãƒ“ãƒ«ãƒ‰ã™ã‚Œã°è‰¯ã„ã‹ã€æ•™ãˆã¦ã„ãŸã ã‘ãªã„ã§ã—ã‚‡ã†ã‹ã€‚
                    ä»¥ä¸‹ã®å›³ã®ã‚ˆã†ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã—ã¦ã„ã¾ã™ãŒã€ã‚³ãƒ³ãƒ†ãƒŠä¸Šã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹jarãƒ•ã‚¡ã‚¤ãƒ«å†…ã§sqs-consumerã¨spring-batchã‚¢ãƒ—ãƒªã®
                    ä¾å­˜é–¢ä¿‚ã‚’ã©ã®ã‚ˆã†ã«è§£æ±ºã™ã‚Œã°ã‚ˆã„ã‹ã€åˆ†ã‹ã‚‰ãšã¯ã¾ã£ã¦ã—ã¾ã£ã¦ã„ã‚‹çŠ¶æ³ã§ã™ã€‚
                    ãƒ“ãƒ«ãƒ‰ã«åˆ©ç”¨ã—ã¦ã„ã‚‹pom.xmlã¨Dockerfileã¯ä»¥ä¸‹ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ã€‚
                    <br>
                    <a href src="https://github.com/yushin1402/aws-cloudnative-sqsapp/tree/master/sqs-consumer">https://github.com/yushin1402/aws-cloudnative-sqsapp/tree/master/sqs-consumer</a>
                    </p>
                    <p>
                    <br>
                    [æ­£å¸¸çµ‚äº†ã—ã¦ã„ã‚‹STSä¸Šã§ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã®å‹•ä½œã‚¤ãƒ¡ãƒ¼ã‚¸(æ–è—¤ã®ç†è§£)]
                    <br>
                    <img src="image/sqs-executeonsts.png">
                    </p>
                    <br>
                    <br>

                    <p>[èª¿æŸ»çŠ¶æ³]</p>
                    <p>
                    STSä¸Šã§ã¯ä»¥ä¸‹ã®é€šã‚Šã€æ­£å¸¸ã«ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡ŒãŒå‡ºæ¥ã¦ã„ã¾ã™ã€‚
                    </p>
                    <img src="image/sts1.png">
                    <br>
                    <br>
                    <img src="image/sts2.png">
                    <br>
                    <p>[å®Ÿè¡Œçµæœ]</p>
                    <pre><code>
            .   ____          _            __ _ _
            /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
           ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
            \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
             '  |____| .__|_| |_|_| |_\__, | / / / /
            =========|_|==============|___/=/_/_/_/
           [32m :: Spring Boot :: [39m      [2m (v2.1.7.RELEASE)[0;39m
           
           [36mo.d.mynavi.sample.aws.sqs.config.App    [0;39m [2m:[0;39m Starting App on DESKTOP-VU8QFTR with PID 13568 (C:\study\AWS\mynavi-sample-aws-sqs\sqs-consumer\target\classes started by user in C:\study\AWS\mynavi-sample-aws-sqs\sqs-consumer)
           [36mo.d.mynavi.sample.aws.sqs.config.App    [0;39m [2m:[0;39m The following profiles are active: dev
           [36mtrationDelegate$BeanPostProcessorChecker[0;39m [2m:[0;39m Bean 'credentialsProvider' of type [org.springframework.cloud.aws.core.credentials.CredentialsProviderFactoryBean] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
           [36mtrationDelegate$BeanPostProcessorChecker[0;39m [2m:[0;39m Bean 'credentialsProvider' of type [com.amazonaws.auth.DefaultAWSCredentialsProviderChain] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
           [36mo.s.j.d.e.EmbeddedDatabaseFactory       [0;39m [2m:[0;39m Starting embedded database: url='jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=false', username='sa'
           [36mo.s.b.c.c.a.DefaultBatchConfigurer      [0;39m [2m:[0;39m No transaction manager was provided, using a DataSourceTransactionManager
           [36mo.s.b.c.r.s.JobRepositoryFactoryBean    [0;39m [2m:[0;39m No database type set, using meta data indicating: H2
           [36mo.s.b.c.l.support.SimpleJobLauncher     [0;39m [2m:[0;39m No TaskExecutor has been set, defaulting to synchronous executor.
           [36mo.s.b.c.l.AbstractListenerFactoryBean   [0;39m [2m:[0;39m org.springframework.batch.item.ItemWriter is an interface. The implementing class will not be queried for annotation based listener configurations. If using @StepScope on a @Bean method, be sure to return the implementing class so listener annotations can be used.
           [36mo.s.b.c.l.AbstractListenerFactoryBean   [0;39m [2m:[0;39m org.springframework.batch.item.ItemProcessor is an interface. The implementing class will not be queried for annotation based listener configurations. If using @StepScope on a @Bean method, be sure to return the implementing class so listener annotations can be used.
           [36mo.s.s.concurrent.ThreadPoolTaskExecutor [0;39m [2m:[0;39m Initializing ExecutorService
           [36mo.d.mynavi.sample.aws.sqs.config.App    [0;39m [2m:[0;39m Started App in 6.869 seconds (JVM running for 8.021)
           
                    </code></pre>
                    <p>
                    ä¸€æ–¹ã§ã€ãƒ“ãƒ«ãƒ‰ã—ãŸjarãƒ•ã‚¡ã‚¤ãƒ«ã‚’javaã‚³ãƒãƒ³ãƒ‰ã§ç›´æ¥å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚
                    ã‚³ãƒ³ãƒ†ãƒŠä¸Šã§å‡ºåŠ›ã•ã‚Œã¦ã„ã‚‹ã‚¨ãƒ©ãƒ¼ã¨ã¯ã¾ãŸåˆ¥ã®ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚
                    </p>
                    <br>
        <pre><code>
            c:\study\AWS\mynavi-sample-aws-sqs\sqs-consumer\target>java -jar sqs-consumer-0.0.1-SNAPSHOT.jar
            .   ____          _            __ _ _
           /\\ / ___'_ __ _ _(_)_ __  __ _ \ \ \ \
          ( ( )\___ | '_ | '_| | '_ \/ _` | \ \ \ \
           \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
            '  |____| .__|_| |_|_| |_\__, | / / / /
           =========|_|==============|___/=/_/_/_/
           :: Spring Boot ::        (v2.1.7.RELEASE)
          
          2022-01-24 00:16:37.572  INFO 13328 --- [           main] o.d.mynavi.sample.aws.sqs.config.App     : Starting App v0.0.1-SNAPSHOT on DESKTOP-VU8QFTR with PID 13328 (C:\study\AWS\mynavi-sample-aws-sqs\sqs-consumer\target\sqs-consumer-0.0.1-SNAPSHOT.jar started by user in c:\study\AWS\mynavi-sample-aws-sqs\sqs-consumer\target)
          2022-01-24 00:16:37.575  INFO 13328 --- [           main] o.d.mynavi.sample.aws.sqs.config.App     : The following profiles are active: dev
          2022-01-24 00:16:43.069  WARN 13328 --- [           main] s.c.a.AnnotationConfigApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'messageListener': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [org.debugroom.mynavi.sample.aws.sqs.app.listener.MessageListener] from ClassLoader [org.springframework.boot.loader.LaunchedURLClassLoader@1698c449]
          2022-01-24 00:16:43.088  INFO 13328 --- [           main] ConditionEvaluationReportLoggingListener :
          
          Error starting ApplicationContext. To display the conditions report re-run your application with 'debug' enabled.
          2022-01-24 00:16:43.100 ERROR 13328 --- [           main] o.s.boot.SpringApplication               : Application run failed
          
          org.springframework.beans.factory.BeanCreationException: Error creating bean with name 'messageListener': Lookup method resolution failed; nested exception is java.lang.IllegalStateException: Failed to introspect Class [org.debugroom.mynavi.sample.aws.sqs.app.listener.MessageListener] from ClassLoader [org.springframework.boot.loader.LaunchedURLClassLoader@1698c449]
                  at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:265) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.determineConstructorsFromBeanPostProcessors(AbstractAutowireCapableBeanFactory.java:1269) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBeanInstance(AbstractAutowireCapableBeanFactory.java:1184) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFactory.java:555) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFactory.java:515) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.AbstractBeanFactory.lambda$doGetBean$0(AbstractBeanFactory.java:320) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:222) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.AbstractBeanFactory.doGetBean(AbstractBeanFactory.java:318) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:199) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:845) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:877) ~[spring-context-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:549) ~[spring-context-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:743) ~[spring-boot-2.1.7.RELEASE.jar!/:2.1.7.RELEASE]
                  at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:390) ~[spring-boot-2.1.7.RELEASE.jar!/:2.1.7.RELEASE]
                  at org.springframework.boot.SpringApplication.run(SpringApplication.java:312) ~[spring-boot-2.1.7.RELEASE.jar!/:2.1.7.RELEASE]
                  at org.springframework.boot.SpringApplication.run(SpringApplication.java:1214) ~[spring-boot-2.1.7.RELEASE.jar!/:2.1.7.RELEASE]
                  at org.springframework.boot.SpringApplication.run(SpringApplication.java:1203) ~[spring-boot-2.1.7.RELEASE.jar!/:2.1.7.RELEASE]
                  at org.debugroom.mynavi.sample.aws.sqs.config.App.main(App.java:10) ~[classes!/:0.0.1-SNAPSHOT]
                  at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
                  at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[na:na]
                  at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
                  at java.base/java.lang.reflect.Method.invoke(Method.java:564) ~[na:na]
                  at org.springframework.boot.loader.MainMethodRunner.run(MainMethodRunner.java:48) ~[sqs-consumer-0.0.1-SNAPSHOT.jar:0.0.1-SNAPSHOT]
                  at org.springframework.boot.loader.Launcher.launch(Launcher.java:87) ~[sqs-consumer-0.0.1-SNAPSHOT.jar:0.0.1-SNAPSHOT]
                  at org.springframework.boot.loader.Launcher.launch(Launcher.java:51) ~[sqs-consumer-0.0.1-SNAPSHOT.jar:0.0.1-SNAPSHOT]
                  at org.springframework.boot.loader.JarLauncher.main(JarLauncher.java:52) ~[sqs-consumer-0.0.1-SNAPSHOT.jar:0.0.1-SNAPSHOT]
          Caused by: java.lang.IllegalStateException: Failed to introspect Class [org.debugroom.mynavi.sample.aws.sqs.app.listener.MessageListener] from ClassLoader [org.springframework.boot.loader.LaunchedURLClassLoader@1698c449]
                  at org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:507) ~[spring-core-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:404) ~[spring-core-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.util.ReflectionUtils.doWithMethods(ReflectionUtils.java:389) ~[spring-core-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  at org.springframework.beans.factory.annotation.AutowiredAnnotationBeanPostProcessor.determineCandidateConstructors(AutowiredAnnotationBeanPostProcessor.java:248) ~[spring-beans-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  ... 25 common frames omitted
          Caused by: java.lang.NoClassDefFoundError: org/springframework/batch/core/repository/JobExecutionAlreadyRunningException
                  at java.base/java.lang.Class.getDeclaredMethods0(Native Method) ~[na:na]
                  at java.base/java.lang.Class.privateGetDeclaredMethods(Class.java:3244) ~[na:na]
                  at java.base/java.lang.Class.getDeclaredMethods(Class.java:2387) ~[na:na]
                  at org.springframework.util.ReflectionUtils.getDeclaredMethods(ReflectionUtils.java:489) ~[spring-core-5.1.9.RELEASE.jar!/:5.1.9.RELEASE]
                  ... 28 common frames omitted
          Caused by: java.lang.ClassNotFoundException: org.springframework.batch.core.repository.JobExecutionAlreadyRunningException
                  at java.base/java.net.URLClassLoader.findClass(URLClassLoader.java:435) ~[na:na]
                  at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:589) ~[na:na]
                  at org.springframework.boot.loader.LaunchedURLClassLoader.loadClass(LaunchedURLClassLoader.java:93) ~[sqs-consumer-0.0.1-SNAPSHOT.jar:0.0.1-SNAPSHOT]
                  at java.base/java.lang.ClassLoader.loadClass(ClassLoader.java:522) ~[na:na]
                  ... 32 common frames omitted
          
                    </code></pre>
                </p>
            </ul>
        </p>
    </div>
</body>
</html>
